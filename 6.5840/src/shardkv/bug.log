Test: snapshots, join, and leave ...
fatal error: concurrent map iteration and map write

goroutine 8217 [running]:
runtime.throw({0x636316?, 0xc0004be1e0?})
	/usr/lib/go-1.18/src/runtime/panic.go:992 +0x71 fp=0xc0005c5478 sp=0xc0005c5448 pc=0x4360d1
runtime.mapiternext(0xc0003cc598?)
	/usr/lib/go-1.18/src/runtime/map.go:871 +0x4eb fp=0xc0005c54e8 sp=0xc0005c5478 pc=0x41008b
reflect.mapiternext(0x4c77cf?)
	/usr/lib/go-1.18/src/runtime/map.go:1378 +0x19 fp=0xc0005c5500 sp=0xc0005c54e8 pc=0x462ad9
reflect.(*MapIter).Next(0xc0003cc580?)
	/usr/lib/go-1.18/src/reflect/value.go:1787 +0x7e fp=0xc0005c5530 sp=0xc0005c5500 pc=0x4c79fe
encoding/gob.(*Encoder).encodeMap(0xc00026d4a0, 0xc00050c180?, {0x5f5300?, 0xc000260a70?, 0x4c58c6?}, 0x61ef60?, 0xc0002609c0?, 0xc00024ae28?, 0x60a280?)
	/usr/lib/go-1.18/src/encoding/gob/encode.go:373 +0x3f2 fp=0xc0005c5608 sp=0xc0005c5530 pc=0x5a0692
encoding/gob.encOpFor.func3(0x61ef60?, 0xc0003c32c0, {0x5f5300?, 0xc000260a70?, 0x4900000000000006?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:571 +0x145 fp=0xc0005c56a0 sp=0xc0005c5608 pc=0x5a2925
encoding/gob.(*Encoder).encodeStruct(0xc00026d4a0, 0xc0004be1e0, 0xc000465038, {0x61ef60?, 0xc0002609c0?, 0xc0005c57c0?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:328 +0x2d1 fp=0xc0005c5760 sp=0xc0005c56a0 pc=0x59f8f1
encoding/gob.(*Encoder).encode(0xc00026d4a0, 0xc0002507b0?, {0x61ef60?, 0xc0002609c0?, 0xc0000adf40?}, 0xc0000adf40)
	/usr/lib/go-1.18/src/encoding/gob/encode.go:701 +0x1d1 fp=0xc0005c5810 sp=0xc0005c5760 pc=0x5a3b91
encoding/gob.(*Encoder).encodeInterface(0xc00026d4a0, 0xc00026d4d8, {0x5f0ae0?, 0xc00014ee70?, 0x59e05e?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:419 +0x80f fp=0xc0005c5988 sp=0xc0005c5810 pc=0x5a0f6f
encoding/gob.encOpFor.func5(0x60a040?, 0xc0003c3240, {0x5f0ae0?, 0xc00014ee70?, 0x0?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:589 +0xe5 fp=0xc0005c59e0 sp=0xc0005c5988 pc=0x5a1e05
encoding/gob.(*Encoder).encodeStruct(0xc00026d4a0, 0xc00026d4d8, 0xc0002904f8, {0x60a040?, 0xc00014ee60?, 0x3?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:328 +0x2d1 fp=0xc0005c5aa0 sp=0xc0005c59e0 pc=0x59f8f1
encoding/gob.encOpFor.func4(0x5e3e40?, 0xc0003c3200, {0x60a040?, 0xc00014ee60?, 0x0?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:581 +0xc5 fp=0xc0005c5b10 sp=0xc0005c5aa0 pc=0x5a2785
encoding/gob.(*Encoder).encodeArray(0x5e3e40?, 0xc00037b908?, {0x5e3e40?, 0xc00037b908?, 0x40eb0c?}, 0xc00017ea40, 0x0, 0x14, 0x0)
	/usr/lib/go-1.18/src/encoding/gob/encode.go:351 +0x4e8 fp=0xc0005c5c30 sp=0xc0005c5b10 pc=0x59fee8
encoding/gob.encOpFor.func1(0x5e3e40?, 0xc0003c31c0, {0x5e3e40?, 0xc00037b908?, 0xc0005c5d38?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:551 +0xf4 fp=0xc0005c5cc0 sp=0xc0005c5c30 pc=0x5a2bb4
encoding/gob.(*Encoder).encodeSingle(0x5e3e40?, 0xc00037b908?, 0xc000288d40?, {0x5e3e40?, 0xc00037b908?, 0xc0005c5da8?})
	/usr/lib/go-1.18/src/encoding/gob/encode.go:301 +0x219 fp=0xc0005c5d48 sp=0xc0005c5cc0 pc=0x59f539
encoding/gob.(*Encoder).encode(0xc00026d4a0, 0xc0002507b0?, {0x5e3e40?, 0xc00037b908?, 0xc000288d40?}, 0xc000288d40)
	/usr/lib/go-1.18/src/encoding/gob/encode.go:703 +0x1a6 fp=0xc0005c5df8 sp=0xc0005c5d48 pc=0x5a3b66
encoding/gob.(*Encoder).EncodeValue(0xc00026d4a0, {0x5e3e40?, 0xc00037b908?, 0x5e3e40?})
	/usr/lib/go-1.18/src/encoding/gob/encoder.go:251 +0x42e fp=0xc0005c5ec8 sp=0xc0005c5df8 pc=0x5a506e
encoding/gob.(*Encoder).Encode(0x5e3e40?, {0x5e3e40?, 0xc00037b908?})
	/usr/lib/go-1.18/src/encoding/gob/encoder.go:176 +0xa5 fp=0xc0005c5f08 sp=0xc0005c5ec8 pc=0x5a4a45
6.5840/labgob.(*LabEncoder).Encode(0xc00020e020, {0x5e3e40, 0xc00037b908})
	/home/ppdog/Documents/github/6.5840/src/labgob/labgob.go:34 +0x45 fp=0xc0005c5f30 sp=0xc0005c5f08 pc=0x5ac0c5
6.5840/raft.(*Raft).persist.func1()
	/home/ppdog/Documents/github/6.5840/src/raft/raft.go:132 +0x12b fp=0xc0005c5fe0 sp=0xc0005c5f30 pc=0x5b27cb
runtime.goexit()
	/usr/lib/go-1.18/src/runtime/asm_amd64.s:1571 +0x1 fp=0xc0005c5fe8 sp=0xc0005c5fe0 pc=0x468861
created by 6.5840/raft.(*Raft).persist
	/home/ppdog/Documents/github/6.5840/src/raft/raft.go:127 +0x10a
